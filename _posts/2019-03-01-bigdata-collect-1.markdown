---
layout: post
title:  "如何做好数据埋点工作"
date:   2019-03-01 00:18:23 +0700
categories: [bigdata]
---

#### 概述  
做了些年的数据工作准备写点什么，想了想把数据方面的知识整理一下。今天我们先讲数据埋点，然后一步一步往后面推进。
  
  
#### 什么是数据埋点  
什么是数据埋点，做过数据或者没做过数据的对这个词，可能不是那以熟悉。其它数据埋点是数据采集的一种方式，通过定点的方式将数据采集上来。
这种场景大部出现偏互联网方面的产品上，通过需要收集用户一些行为数据，进而通过埋点的方式对数据进行采集，而传统业务大部分以业务数据为主
不需要进行相关的埋点工作，通过数据同步等手段，以较轻的成本方式获取相关数据，而数据埋点侧是通过在原代码中通过注入的方式获取某种状态下的
相关数据。
   
   
#### 为什么要进行数据埋点　　
上面说过数据埋点是一种数据采集的方式，从而我们得知数据埋点的主要作用则是获取数据
而获取数据作用有很多，比如我们用于计算公司核心指标，量化公司业务情况。通过计算数据
云量化产品的改进是否有效，运营策略是否有效等。数据埋点本质只是数据处理的一个环节，同
时也是起始环节相对比数据平台来说数据埋点就数据生产点，通过技术手段将数据采集到。进而为
产品分析／决策等方面提供草料。
  
  
#### 数据埋点需要注意什么  
数据埋点是一个细致的活，我带过很多年数据团队，碰到很多数据产品经理不一定可以干好这个活
，另外一线互联网公司通常也会将岗位单独出现叫作“数据埋点产品”，为什么需要独立出现，其实
该份工作还是一个技术活，不仅需要对产品有深的理解，同时需要对客户端相关的技术需要一定的了解
另外还需要对数据处理流程有所了解，这样才能设计好一个好的数据埋点方案，同时又能降低数据处理
的复杂的，需要平衡客户端与服务端的资源情况，例如　我们需要统计一个用户在平台上呆了多久，通常我们
有几种方式，通过心跳或者通过其它手段，如果我们通过心跳又会涉及我们把时间累计放在客户端还是放在服务端
放在客户端的问题是什么，放在服务端计算的问题是什么？我们应该间隔多久上报一个心跳，一个心跳中需要包括那些信息
，这些都在埋点过程需要注意并需要考虑的事，负责导致的问题收集上来的数据不仅无用而且会浪费开发人员的时间
另外也会浪费平台的存储／计算资源等。  
我将数据埋点抽像为如下几个方面  
- 上报时机：什么时间触发该埋点数据采集，什么时侯上报给服务器，是否需要采取离线等  
- 上报协议：通过什么的协议组织具体的数据格式是HTTP 的　ＧＥＴ还是HTTP POST　还是采用Thrift协议等等  
- 采集信息字段：定义具体需要采集相关信息并按协议组织好具体的数据  
当然文档里面最好有些具体的场景说明或者示例说明。同时现在考虑不同终端的特性，如ＷＥＢ端与移动端的区别
  
#### 定义一个数据埋点的文档  
下面我们以定义一个采集用户的浏览页面的数据埋点的为例定义如下：　　
###### 上报时机  
上报点：页面加载完成时上报，上报完成是指ＷＥＢ页面的ＤＯＭ结构加载完成，采用实时上报
上报范围：该活动涉及的所有页面
  
###### 协议定义  
上报协议采用HTTP GET方式  
上报数据地址:http://www.viewc.org/logs
  
###### 字段定义  
```$xslt
一个字段的定义包含三个部分　　
字段名：具体的名称一般使用简化的字段　　
类型：该字段使用什么类型的数据  
说明：对于该字段的描述用于让别人对该字段取什么的值有可执行理解  

EG:

cookie  String  获取网站Cookie UUID,用于标识唯一的用户，如果该值不存在时，则生一个UUID的Cookie,种在viewc.org下面，有效期999年　　
url     String  获取当前浏览器地址，用于标识当前页面  
ref     String  获取当前页面的来源页面，如果没有则为空  
lob     String  扩展字段用于业务扩展格式采用 key=value,多个值以＆分隔，并进行urlencode
```
  
  
  
#### 从数据埋点升级为采集SDK  
当我们定义好这个文档，发给产品经理及开发进行评审从而开始执行，给对应的页面加上数据埋点，我们发现这种方式
执行效率是低下的，我们有什么好的方式提高效率，能不能将相关工作通过相关工具将其自动化。答案当然是可以，下一节中
我们将讲如何设计一个ＷＥＢ　ＳＤＫ　将该部分工作自动化。
